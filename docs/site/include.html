<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Include</title>
    <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      div.columns{display: flex; gap: min(4vw, 1.5em);}
      div.column{flex: auto; overflow-x: auto;}
      div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
      /* The extra [class] is a hack that increases specificity enough to
         override a similar rule in reveal.js */
      ul.task-list[class]{list-style: none;}
      ul.task-list li input[type="checkbox"] {
        font-size: inherit;
        width: 0.8em;
        margin: 0 0.8em 0.2em -1.6em;
        vertical-align: middle;
      }
      .display.math{display: block; text-align: center; margin: 0.5rem auto;}
      /* CSS for syntax highlighting */
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
        }
      pre.numberSource { margin-left: 3em;  padding-left: 4px; }
      div.sourceCode
        { color: #ebdbb2; background-color: #282828; }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
      code span { color: #ebdbb2; } /* Normal */
      code span.al { color: #282828; background-color: #cc241d; font-weight: bold; } /* Alert */
      code span.an { color: #98971a; } /* Annotation */
      code span.at { color: #d79921; } /* Attribute */
      code span.bn { color: #f67400; } /* BaseN */
      code span.bu { color: #d65d0e; } /* BuiltIn */
      code span.cf { color: #cc241d; font-weight: bold; } /* ControlFlow */
      code span.ch { color: #b16286; } /* Char */
      code span.cn { color: #b16286; font-weight: bold; } /* Constant */
      code span.co { color: #928374; } /* Comment */
      code span.cv { color: #928374; } /* CommentVar */
      code span.do { color: #98971a; } /* Documentation */
      code span.dt { color: #d79921; } /* DataType */
      code span.dv { color: #f67400; } /* DecVal */
      code span.er { color: #cc241d; text-decoration: underline; } /* Error */
      code span.ex { color: #689d6a; font-weight: bold; } /* Extension */
      code span.fl { color: #f67400; } /* Float */
      code span.fu { color: #689d6a; } /* Function */
      code span.im { color: #689d6a; } /* Import */
      code span.in { color: #282828; background-color: #83a598; } /* Information */
      code span.kw { color: #ebdbb2; font-weight: bold; } /* Keyword */
      code span.op { color: #ebdbb2; } /* Operator */
      code span.ot { color: #689d6a; } /* Other */
      code span.pp { color: #d65d0e; } /* Preprocessor */
      code span.re { color: #928374; background-color: #1d2021; } /* RegionMarker */
      code span.sc { color: #b16286; } /* SpecialChar */
      code span.ss { color: #98971a; } /* SpecialString */
      code span.st { color: #98971a; } /* String */
      code span.va { color: #458588; } /* Variable */
      code span.vs { color: #98971a; } /* VerbatimString */
      code span.wa { color: #282828; background-color: #fabd2f; } /* Warning */
    </style>
        <link rel="stylesheet" href="style.css" />
        <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@devOpifex" />
    <meta name="twitter:title" content="builder - R preprocessor" />
    <meta
      name="twitter:description"
      content="An R preprocessor for the R programming language"
    />
    <meta
      name="twitter:image"
      content="https://builder.opifex.org/builder.png"
    />
  </head>
  <body>
    <main>
      <nav>
        <a href="index.html">Home</a>
        <a href="installation.html">Install</a>
        <a href="get-started.html">Get started</a>
        <div class="dropdown">
          <a href="#">
            Docs
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              id="menu-icon"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="m19.5 8.25-7.5 7.5-7.5-7.5"
              />
            </svg>
          </a>
          <div class="dropdown-content">
            <a href="packages.html">Packages</a>
            <a href="directives.html">Directives</a>
            <a href="macros.html">Macros</a>
            <a href="include.html">Include</a>
            <a href="import.html">Import</a>
            <a href="fstrings.html">F-strings</a>
            <a href="const.html">Const</a>
            <a href="deconstruct.html">Deconstruct</a>
            <a href="preflight.html">Preflight</a>
            <a href="plugins.html">Plugins</a>
            <a href="tests.html">Tests</a>
            <a href="prepend-append.html">Prepend</a>
            <a href="deadcode.html">Dead Code</a>
          </div>
        </div>
      </nav>
      <h1 id="include">Include</h1>
      <p>The <code>#include</code> directive allows you to read external
      files at build time and process them using macros. This enables
      you to embed file contents (like SQL queries, templates, or
      configuration) directly into your R code as variables.</p>
      <h2 id="advantages">Advantages</h2>
      <ul>
      <li><strong>Separation of concerns:</strong> Keep SQL queries,
      templates, and other content in separate files while still
      embedding them in your code at build time.</li>
      <li><strong>Build-time processing:</strong> File contents are read
      and processed during preprocessing, not at runtime, eliminating
      file I/O overhead.</li>
      <li><strong>Macro integration:</strong> Use any macro to process
      file contents, enabling custom transformations and
      formatting.</li>
      <li><strong>Type safety:</strong> File contents are converted to R
      objects at build time, catching errors early.</li>
      </ul>
      <h2 id="basic-syntax">Basic Syntax</h2>
      <p>The <code>#include</code> directive uses a special syntax that
      specifies a macro to apply, a file path to read, and a variable
      name for the result.</p>
      <p><strong>Syntax:</strong>
      <code>#include:MACRO_NAME file_path variable_name</code></p>
      <p>The directive consists of three space-separated parts:</p>
      <ul>
      <li><code>MACRO_NAME</code> - The name of a previously defined
      macro that takes one argument (the file path)</li>
      <li><code>file_path</code> - The path to the file to include</li>
      <li><code>variable_name</code> - The R variable name that will be
      assigned the processed result</li>
      </ul>
      <h2 id="basic-example">Basic Example</h2>
      <p>The most common use case is reading text files like SQL
      queries. First, define a macro that specifies how to read the
      file:</p>
      <div class="sourceCode" id="cb1"><pre
      class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#define</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">READ</span>(path){</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">readLines</span>(path)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#enddef</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#include:READ sql/query.sql my_query</span></span></code></pre></div>
      <p><strong>Expands to:</strong></p>
      <div class="sourceCode" id="cb2"><pre
      class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>my_query <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;SELECT * FROM users&quot;</span>)</span></code></pre></div>
      <p>The <code>READ</code> macro uses R’s <code>readLines()</code>
      function to read the file. The result is captured using R’s
      <code>dput()</code> function and assigned to the specified
      variable.</p>
      <h2 id="how-it-works">How It Works</h2>
      <p>When the preprocessor encounters an <code>#include</code>
      directive:</p>
      <ol type="1">
      <li>It parses the macro name, file path, and variable name</li>
      <li>It looks up the macro definition (e.g., <code>READ</code>)
      from your <code>#define</code> statements</li>
      <li>It constructs an R expression:
      <code>MACRO_NAME('file_path') |&gt; dput() |&gt; capture.output()</code></li>
      <li>It executes this R expression to process the file</li>
      <li>It generates an assignment:
      <code>variable_name &lt;- &lt;result&gt;</code></li>
      </ol>
      <p>This happens at build time, so the final R code contains no
      file reading operations—just the processed data.</p>
      <h3 id="reading-csv-data">Reading CSV Data</h3>
      <p>Embed small lookup tables or static data directly in your
      code:</p>
      <div class="sourceCode" id="cb3"><pre
      class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#define</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">READ_CSV</span>(path){</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.csv</span>(path)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#enddef</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">#include:READ_CSV data/lookup_table.csv lookup_data</span></span></code></pre></div>
      <h3 id="reading-template-files">Reading Template Files</h3>
      <p>Read template strings for reports or emails:</p>
      <div class="sourceCode" id="cb4"><pre
      class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#define</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">READ_TEMPLATE</span>(path){</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">readLines</span>(path) <span class="sc">|&gt;</span> <span class="fu">paste</span>(<span class="at">collapse =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#enddef</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#include:READ_TEMPLATE templates/email_body.txt email_template</span></span></code></pre></div>
      <h2 id="important-notes">Important Notes</h2>
      <ul>
      <li>The macro specified in <code>#include:MACRO_NAME</code> must
      be defined before the <code>#include</code> directive</li>
      <li>The macro must accept exactly one parameter (the file
      path)</li>
      <li>File paths are relative to the build directory or can be
      absolute paths</li>
      <li>The result is captured using R’s <code>dput()</code> function,
      which converts R objects to their code representation</li>
      <li>File reading happens at build time, not runtime, so files must
      exist when running the builder</li>
      <li>Changes to included files require rebuilding to be reflected
      in the output</li>
      <li>The macro can use any R code for processing—you’re not limited
      to simple <code>readLines()</code></li>
      <li>Variable names should follow R naming conventions and will be
      created in the global scope</li>
      </ul>
      <h2 id="processing-pipeline">Processing Pipeline</h2>
      <p>The <code>#include</code> directive is processed after
      <code>#define</code> macro expansion but as part of the same
      preprocessing pass. This means:</p>
      <ol type="1">
      <li>First, all <code>#define</code> macros are defined and
      expanded</li>
      <li>Then, <code>#include</code> directives are processed using the
      defined macros</li>
      <li>The result is pure R code with all preprocessing directives
      removed</li>
      </ol>
      <h2 id="common-use-cases">Common Use Cases</h2>
      <ul>
      <li><strong>SQL Queries:</strong> Keep SQL in <code>.sql</code>
      files with proper syntax highlighting and embed them in R
      packages</li>
      <li><strong>Configuration:</strong> Store configuration in JSON,
      YAML, or other formats and embed at build time</li>
      <li><strong>Static Data:</strong> Include small reference datasets
      or lookup tables directly in code</li>
      <li><strong>Templates:</strong> Store HTML, Markdown, or text
      templates externally and include them for string generation</li>
      <li><strong>Constants:</strong> Define large constant structures
      in separate files for better organization</li>
      </ul>
    </main>
  </body>
</html>
