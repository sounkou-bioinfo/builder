<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Builder - Macros</title>
</head>
<body>
  <nav>
    <a href="/">Builder</a> |
    <a href="/packages.html">Packages</a> |
    <a href="/directives.html">Directives</a> |
    <a href="/deconstruct.html">Deconstruct</a> |
    <a href="/macros.html">Macros</a> |
    <a href="/include.html">Include</a> |
    <a href="/import.html">Import</a> |
    <a href="/fstrings.html">f-strings</a> |
    <a href="/tests.html">Tests</a> |
    <a href="/const.html">Constants</a> |
    <a href="/preflight.html">Preflight</a> |
    <a href="/plugins.html">Plugins</a>
  </nav>
  <main>
    <h1>Macros</h1>
    <p>
      Macros are function-like preprocessor directives that allow you to
      define reusable code templates with parameters. Unlike simple
      <code>#define</code> replacements, macros can accept arguments and
      expand into multiple lines of code.
    </p>
    <h2>Advantages</h2>
    <ul>
      <li>
        <strong>Easy metaprogramming:</strong> Write code that generates code,
        enabling powerful abstractions and code generation patterns.
      </li>
      <li>
        <strong>Zero overhead:</strong> Macros have no runtime performance
        cost since they're expanded at compile time.
      </li>
      <li>
        <strong>Compile time expansion:</strong> All macro processing happens
        during preprocessing, before your code executes.
      </li>
    </ul>
    <h2>Basic Syntax</h2>
    <p>
      Macros are defined using <code>#define</code> on its own line,
      followed by the macro signature and body. The macro ends with
      <code>#enddef</code>.
    </p>
    <p><strong>Syntax:</strong></p>
    <pre><code>#define
MACRO_NAME(arg1, arg2, ...){
  body
}
#enddef</code></pre>
    <pre><code>#define
LOG_EVAL(expr){
  cat("Evaluating stuff\n")
  expr
}
#enddef

LOG_EVAL(sum(1, 1, 1))</code></pre>
    <p><strong>Expands to:</strong></p>
    <pre><code>cat("Evaluating stuff\n")
sum(1, 1, 1)</code></pre>
    <h2>Multiline Macro Bodies</h2>
    <p>
      Macro bodies can contain multiple lines of R code with full syntax
      highlighting support in your editor.
    </p>
    <pre><code>#define
DEBUG_BLOCK(var, message){
  cat("Debug:", message, "\n")
  cat("Value is", var, "\n")
  cat("Type:", typeof(var), "\n")
}
#enddef

x &lt;- 42
DEBUG_BLOCK(x, "Checking variable")</code></pre>
    <p><strong>Expands to:</strong></p>
    <pre><code>x &lt;- 42
cat("Debug:", "Checking variable", "\n")
cat("Value is", x, "\n")
cat("Type:", typeof(x), "\n")</code></pre>
    <h2>Parameter Substitution</h2>
    <p>
      Macro parameters are replaced throughout the macro body when the macro
      is invoked. All occurrences of the parameter name will be substituted
      with the corresponding argument.
    </p>
    <pre><code>#define
REPEAT(n, action){
  for (i in 1:n) {
    action
  }
}
#enddef

REPEAT(3, print("Hello"))</code></pre>
    <p><strong>Expands to:</strong></p>
    <pre><code>for (i in 1:3) {
  print("Hello")
}</code></pre>
    <h2>Macros with Multiple Arguments</h2>
    <p>
      Macros can accept multiple arguments, which are separated by commas in
      both the definition and invocation.
    </p>
    <pre><code>#define
VALIDATE(value, min, max){
  if (value &lt; min || value &gt; max) {
    stop("Value out of range: ", value)
  }
}
#enddef

x &lt;- 15
VALIDATE(x, 0, 100)</code></pre>
    <p><strong>Expands to:</strong></p>
    <pre><code>x &lt;- 15
if (x &lt; 0 || x &gt; 100) {
  stop("Value out of range: ", x)
}</code></pre>
    <h2>Practical Examples</h2>
    <h3>Logging Macro</h3>
    <pre><code>#define
LOG(level, msg){
  cat("[", level, "] ", msg, "\n", sep = "")
}
#enddef

LOG("INFO", "Application started")
LOG("ERROR", "Something went wrong")</code></pre>
    <p><strong>Expands to:</strong></p>
    <pre><code>cat("[", "INFO", "] ", "Application started", "\n", sep = "")
cat("[", "ERROR", "] ", "Something went wrong", "\n", sep = "")</code></pre>
    <h3>Try-Catch Wrapper</h3>
    <pre><code>#define
TRY_CATCH(code, error_msg){
  tryCatch({
    code
  }, error = function(e) {
    cat(error_msg, ":", e$message, "\n")
  })
}
#enddef

TRY_CATCH(risky_operation(), "Operation failed")</code></pre>
    <p><strong>Expands to:</strong></p>
    <pre><code>tryCatch({
  risky_operation()
}, error = function(e) {
  cat("Operation failed", ":", e$message, "\n")
})</code></pre>
    <h3>Timing Macro</h3>
    <pre><code>#define
TIME_IT(expr){
  start &lt;- Sys.time()
  result &lt;- expr
  end &lt;- Sys.time()
  cat("Execution time:", end - start, "\n")
  result
}
#enddef

TIME_IT(slow_computation())</code></pre>
    <p><strong>Expands to:</strong></p>
    <pre><code>start &lt;- Sys.time()
result &lt;- slow_computation()
end &lt;- Sys.time()
cat("Execution time:", end - start, "\n")
result</code></pre>
    <h2>Important Notes</h2>
    <ul>
      <li>Macros start with <code>#define</code> alone on a line</li>
      <li>The macro signature and body follow on subsequent lines</li>
      <li>Macro bodies must be enclosed in curly braces <code>{}</code></li>
      <li>Macros end with <code>#enddef</code></li>
      <li>
        Macros support multiline definitions and can span many lines (up to
        1024 lines)
      </li>
      <li>
        Macro parameters are simple text substitution - be careful with
        expressions that might be evaluated multiple times
      </li>
      <li>
        Simple <code>#define NAME value</code> constants still work as before
      </li>
    </ul>
  </main>
</body>
</html>
