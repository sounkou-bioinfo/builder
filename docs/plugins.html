<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="light dark" />
    <title>Builder - Plugins</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/styles/atom-one-light.min.css"
      media="(prefers-color-scheme: light)"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/styles/atom-one-dark.min.css"
      media="(prefers-color-scheme: dark)"
    />
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/languages/r.min.js"></script>
  </head>
  <body>
    <main class="container">
      <nav>
        <ul>
          <li>
            <strong><a href="/">Builder</a></strong>
          </li>
        </ul>
        <ul>
          <li>
            <details class="dropdown">
              <summary>Docs</summary>
              <ul dir="rtl">
                <li><a href="/packages">Packages</a></li>
                <li><a href="/directives">Directives</a></li>
                <li><a href="/deconstruct">Deconstruct</a></li>
                <li><a href="/macros">Macros</a></li>
                <li><a href="/include">Include</a></li>
                <li><a href="/import">Import</a></li>
                <li><a href="/fstrings">f-strings</a></li>
                <li><a href="/tests">Tests</a></li>
                <li><a href="/const">Constants</a></li>
                <li><a href="/plugins">Plugins</a></li>
              </ul>
            </details>
          </li>
        </ul>
      </nav>
      <h1>Plugins</h1>
      <p>
        Builder supports plugins to extend processing. Plugins are R packages
        that export a function returning a list of lifecycle methods.
      </p>

      <h2>Usage</h2>
      <p>Specify plugins with the <code>-plugins</code> flag:</p>
      <pre><code>./builder -input srcr -plugins package::function</code></pre>
      <p>
        The format is <code>package::function</code> where
        <code>package</code> is the R package name and <code>function</code> is
        the exported function that creates the plugin.
      </p>

      <h2>Lifecycle Methods</h2>
      <p>Plugins can implement the following methods:</p>

      <h3>setup(input, output)</h3>
      <p>
        Called during initialization with the input and output directory paths.
        Use this to store configuration or perform one-time setup.
      </p>

      <h3>preprocess(str)</h3>
      <p>
        Called on each file's content before Builder processes it. Receives the
        file content as a string and should return the modified content.
      </p>

      <h3>include(str)</h3>
      <p>
        Called when Builder encounters an <code>#include</code> directive.
        Receives the include line and can return a modified path or content.
      </p>

      <h3>end()</h3>
      <p>
        Called when Builder finishes processing all files. Use this for cleanup
        or final operations.
      </p>

      <h2>Example Plugin</h2>
      <p>A simple minifier plugin that replaces newlines with semicolons:</p>
      <pre><code class="language-r">#' @export
plugin &lt;- function() {
  list(
    setup = function(...) {},
    preprocess = function(str, ...) {
      gsub("\n", ";", str)
    },
    include = function(...) {},
    end = function(...) {}
  )
}</code></pre>
      <p>
        Use it with <code>-plugins minifier::plugin</code>. Methods that don't
        need to modify content can return <code>NULL</code> or be empty. Use
        <code>...</code> in function signatures for forward compatibility.
      </p>
    </main>
    <script>
      hljs.highlightAll();
    </script>
  </body>
</html>
