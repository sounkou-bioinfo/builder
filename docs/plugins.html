<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Builder - Plugins</title>
</head>
<body>
  <nav>
    <a href="/">Builder</a> |
    <a href="/packages.html">Packages</a> |
    <a href="/directives.html">Directives</a> |
    <a href="/deconstruct.html">Deconstruct</a> |
    <a href="/macros.html">Macros</a> |
    <a href="/include.html">Include</a> |
    <a href="/import.html">Import</a> |
    <a href="/fstrings.html">f-strings</a> |
    <a href="/tests.html">Tests</a> |
    <a href="/const.html">Constants</a> |
    <a href="/preflight.html">Preflight</a> |
    <a href="/plugins.html">Plugins</a>
  </nav>
  <main>
    <h1>Plugins</h1>
    <p>
      Builder supports plugins to extend processing. Plugins are R packages
      that export a function returning a list of lifecycle methods.
    </p>

    <h2>Usage</h2>
    <p>Specify plugins with the <code>-plugin</code> flag:</p>
    <pre><code>./builder -input srcr -plugin package::function</code></pre>
    <p>
      The format is <code>package::function</code> where
      <code>package</code> is the R package name and <code>function</code> is
      the exported function that creates the plugin.
    </p>

    <h2>Lifecycle Methods</h2>
    <p>Plugins can implement the following methods:</p>

    <h3>setup(input, output)</h3>
    <p>
      Called during initialization with the input and output directory paths.
      Use this to store configuration or perform one-time setup.
    </p>

    <h3>preprocess(str)</h3>
    <p>
      Called on each file's content before Builder processes it. Receives the
      file content as a string and should return the modified content.
    </p>

    <h3>include(str)</h3>
    <p>
      Called when Builder encounters an <code>#include</code> directive.
      Receives the include line and can return a modified path or content.
    </p>

    <h3>end()</h3>
    <p>
      Called when Builder finishes processing all files. Use this for cleanup
      or final operations.
    </p>

    <h2>Example Plugin</h2>
    <p>A simple minifier plugin that replaces newlines with semicolons:</p>
    <pre><code>#' @export
plugin &lt;- function() {
  list(
    setup = function(...) {},
    preprocess = function(str, ...) {
      lines &lt;- strsplit(str, "\n")[[1]]
      lines &lt;- lines[nzchar(trimws(lines))]
      paste(lines, collapse = ";")
    },
    include = function(...) {},
    end = function(...) {}
  )
}</code></pre>
    <p>
      Use it with <code>-plugin minifier::plugin</code>. Methods that don't
      need to modify content can return <code>NULL</code> or be empty. Use
      <code>...</code> in function signatures for forward compatibility.
    </p>
  </main>
</body>
</html>
